"use strict";define(["emitter","vector","field","utils","audio"],function(t,e,i,n,s){var a={canvas:void 0,ctx:void 0,centerX:void 0,centerY:void 0,emitters:[],drawQueue:[],updateQueue:[],fields:[],maxFields:3,initEmitters:function(){var i=new t(this.canvas,this.ctx,this.fields,new e(this.centerX,this.centerY),e.fromAngle(0,2),Math.PI);this.emitters.push(i),this.drawQueue.push(i.draw.bind(i)),this.updateQueue.push(i.update.bind(i))},initFields:function(){var t=new i(this.ctx,new e(this.centerX+this.centerX/2,this.centerY),600);this.fields.push(t),this.drawQueue.push(t.draw.bind(t)),t=new i(this.ctx,new e(this.centerX-this.centerX/2,this.centerY),600),this.fields.push(t),this.drawQueue.push(t.draw.bind(t))},initEvents:function(){var s=this,a=0;this.canvas.addEventListener("click",function(){s.fields.length>=s.maxFields&&(s.fields.pop(),s.drawQueue.pop()),a++;var t;t=a%2===0?-100:100;var h=n.getMouse(this),u=new i(s.ctx,new e(h.x,h.y),t);s.fields.push(u),s.drawQueue.push(u.draw.bind(u))}),this.canvas.addEventListener("oncontextmenu",function(){console.log("right click"),a++;var i=n.getMouse(this),h=new t(s.canvas,s.ctx,s.fields,new e(i.x,i.y),e.fromAngle(0,2),Math.PI);return s.emitters.push(h),s.drawQueue.push(h.draw.bind(h)),s.updateQueue.push(h.update.bind(h)),!1})},update:function(){this.updateQueue.forEach(function(t){t()})},draw:function(){this.drawQueue.forEach(function(t){t()})},animate:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(),this.draw(),window.requestAnimationFrame(this.animate.bind(this))},init:function(){console.log("controller inited"),this.canvas=document.querySelector("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.ctx=this.canvas.getContext("2d"),s.init(document.querySelector("audio")),this.updateQueue.push(s.update.bind(s)),this.initEmitters(),this.initFields(),this.initEvents(),this.animate()}};return a});