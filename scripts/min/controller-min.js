"use strict";define(["emitter","vector","field","utils","audio"],function(e,t,i,n,a){var s={canvas:void 0,ctx:void 0,centerX:void 0,centerY:void 0,emitters:[],drawQueue:[],updateQueue:[],fields:[],maxFields:3,maxEmitters:2,audioData:void 0,initEmitters:function(){var i=new e(this.canvas,this.ctx,this.fields,new t(this.centerX,this.centerY),t.fromAngle(0,2),Math.PI);this.emitters.push(i),this.drawQueue.push(i.draw.bind(i)),this.updateQueue.push(i.update.bind(i))},initFields:function(){var e=new i(this.ctx,new t(this.centerX+this.centerX/2,this.centerY),600);this.fields.push(e),this.drawQueue.push(e.draw.bind(e)),e=new i(this.ctx,new t(this.centerX-this.centerX/2,this.centerY),600),this.fields.push(e),this.drawQueue.push(e.draw.bind(e))},initAudio:function(){a.init(document.querySelector("audio")),this.updateQueue.push(a.update.bind(a)),this.audioData=a.getAudioData()},initEvents:function(){var a=this,s=0;this.canvas.addEventListener("click",function(){a.fields.length>a.maxFields&&a.fields.shift(),s++;var e;e=s%2===0?-100:100;var u=n.getMouse(this),r=new i(a.ctx,new t(u.x,u.y),e);a.fields.push(r),a.drawQueue.push(r.draw.bind(r))}),this.canvas.addEventListener("contextmenu",function(i){if(i.preventDefault(),a.emitters.length<a.maxEmitters){var s=n.getMouse(this),i=new e(a.canvas,a.ctx,a.fields,new t(s.x,s.y),t.fromAngle(Math.random(),Math.random()),n.getRandom(0,.5));a.emitters.push(i),a.drawQueue.push(i.draw.bind(i)),a.updateQueue.push(i.update.bind(i))}return!1}),document.querySelector('select[name="max-emitters"]').onchange=function(){a.maxEmitters=this.value},document.querySelector('select[name="max-fields"]').onchange=function(){a.maxField=this.value},document.querySelector("#max-particles").onchange=function(){var e=this;if(e.value>=5e3&&e.value<8e3)var t=1;else if(e.value>=8e3&&e.value<1e4)var t=2;else if(e.value>=1e4&&e.value<12e3)var t=3;else if(e.value>=1200&&e.value<=15e3)var t=4;a.emitters.forEach(function(i){i.changeParticleNum(e.value,t)})},document.querySelector("#clear-fields").onclick=function(e){e.preventDefault();for(var t=0;t<a.fields.length;t++)a.fields.pop()},document.querySelector("#clear-emitters").onclick=function(e){e.preventDefault();for(var t=0;t<a.emitters.length;t++);a.emitters=[]},document.querySelector("#reset").onclick=function(e){e.preventDefault(),a.emitters=[],a.fields=[],a.drawQueue=[],a.updateQueue=[]}},update:function(){this.updateQueue.forEach(function(e){e()})},draw:function(){this.drawQueue.forEach(function(e){e()})},animate:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.update(),this.draw(),window.requestAnimationFrame(this.animate.bind(this))},init:function(){this.canvas=document.querySelector("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.ctx=this.canvas.getContext("2d"),this.initAudio(),this.initEmitters(),this.initFields(),this.animate(),this.initEvents()}};return s});