define(["particle","vector"],function(t,i){var s=function(){function s(t,i,s,e,h,r){this.position=e,this.velocity=h,this.spread=r||Math.PI/32,this.drawColor="#999",this.maxParticles=2e4,this.emissionRate=2,this.particleSize=1,this.particles=[],this.fields=s,this.ctx=i,this.boundsX=t.width,this.boundsY=t.height}return s.prototype.emitParticle=function(){var s=this.velocity.getAngle()+this.spread-Math.random()*this.spread*2,e=this.velocity.getLength(),h=new i(this.position.x,this.position.y),r=i.fromAngle(s,e);return new t(h,r)},s.prototype.plotParticles=function(){for(var t=[],i,s,e=0;e<this.particles.length;e++)i=this.particles[e],s=i.position,s.x<0||s.x>this.boundsX||s.y<0||s.y>this.boundsY||(i.submitToFields(this.fields),i.move(),t.push(i));this.particles=t},s.prototype.update=function(){if(!(this.particles.length>this.maxParticles)){for(var t=0;t<this.emissionRate;t++)this.particles.push(this.emitParticle());this.plotParticles()}},s.prototype.draw=function(){this.ctx.fillStyle="rgb(0,40,255)";for(var t=0;t<this.particles.length;t++){var i=this.particles[t].position;this.ctx.fillRect(i.x,i.y,this.particleSize,this.particleSize)}},s}();return s});