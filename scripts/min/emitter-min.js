"use strict";define(["particle","vector"],function(t,i){var s=function(){function s(t,i,s,e,r,h){this.position=e,this.velocity=r,this.spread=h||Math.PI/32,this.drawColor="#999",this.maxParticles=1e4,this.emissionRate=2,this.particleSize=2,this.particles=[],this.fields=s,this.ctx=i,this.boundsX=t.width,this.boundsY=t.height}return s.prototype.changeParticleNum=function(t,i){if(this.maxParticles=t,i&&(this.emissionRate=i),this.particles.length>t)for(var s=0;s<this.particles.length-t;s++)this.particles.unshift()},s.prototype.emitParticle=function(){var s=this.velocity.getAngle()+this.spread-Math.random()*this.spread*2,e=this.velocity.getLength(),r=new i(this.position.x,this.position.y),h=i.fromAngle(s,e);return new t(r,h)},s.prototype.plotParticles=function(){for(var t=[],i,s,e=0;e<this.particles.length;e++)i=this.particles[e],s=i.position,s.x<0||s.x>this.boundsX||s.y<0||s.y>this.boundsY||(i.submitToFields(this.fields),i.move(),t.push(i));this.particles=t},s.prototype.update=function(){if(this.particles.length>this.maxParticles)for(var t=0;1e3>t;t++)this.particles.shift();for(var i=0;i<this.emissionRate;i++)this.particles.push(this.emitParticle());this.plotParticles()},s.prototype.draw=function(){for(var t=0;t<this.particles.length;t++){var i=this.particles[t].position;this.ctx.fillStyle=this.particles[t].drawColor,this.ctx.fillRect(i.x,i.y,this.particleSize,this.particleSize)}},s}();return s});